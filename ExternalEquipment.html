<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Debugger-based On-Target Testing: External Test Equipment</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxyStyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="dott_ng_logo_small.png"/></td>
  <td id="projectalign">
   <div id="projectname">Debugger-based On-Target Testing
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">External Test Equipment </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_doc_user_manual_src_external_equipment"></a></p>
<p >By nature, the DOTT framework is open for the integration of arbitrary external test equipment as long as there are Python libraries available for interfacing the equipment. DOTT does not come with a pre-integrated set of such libraries. The section below about PIGPIO is just an example how to utilize a Raspberry Pi you might have anyway sitting on your desk as an USB to I2C (or SPI) bridge from within your tests. This setup is also shown and used in one of the examples shipped with DOTT.</p>
<h1><a class="anchor" id="ExternalRPI"></a>
Raspberry Pi with PIGPIOD</h1>
<p >The <b>PIGPIO Python library</b> together with the <b>PIGPIO daemon</b> installed on a Raspberry Pi enables users to use a Raspberry PI as an I2C or SPI master from within the DOTT test framework. The following figure gives an overview of that setup. The test host, with installed DOTT framework and pigpio library, connects to the Raspberry PI via TCP/IP. There, the pigpio daemon receives these incoming calls and translates them to I2C, SPI, UART of simple GPIO transactions on the I/O pins of the Raspberry.</p>
<div class="fragment"><div class="line">|------------|      TCP/IP       |---------------|      I2C, SPI, ...     |--------|</div>
<div class="line">| TEST HOST  |   &lt;----------&gt;    | RASPBERRY PI  |    &lt;---------------&gt;   | TARGET |</div>
<div class="line">|            |                   |               |                        |        |</div>
<div class="line">| DOTT with  |                   | pigpio daemon |                        |        |</div>
<div class="line">| pigpio lib |                   |               |                        |        |</div>
<div class="line">|------------|                   |---------------|                        |--------|</div>
</div><!-- fragment --><p >Pigpio is a public domain, 3rd party package which is available <a href="http://abyz.me.uk/rpi/pigpio/">here</a> of can be downloaded form <a href="https://github.com/joan2937/pigpio/">GitHub</a>. The pigpio Python library for the host is installed with. The setup procedure for the pigpio daemon on the RaspberryPi is provided in the next section.</p>
<h2><a class="anchor" id="RPISetup"></a>
Raspberry Pi Setup</h2>
<ul>
<li>Get a Raspberry Pi 3 (or 4) together with a reasonably fast MicroSD card (e.g., SanDisk Extreme) of at least 8GB</li>
<li>Install Raspberry Pi OS (formerly Raspbian)</li>
<li>Configure the system according to your likings and make sure that it can be reached from your test host via TCP/IP</li>
<li>Install <b>PIGPIO</b>:</li>
</ul>
<div class="fragment"><div class="line"><span class="comment"># install pigpiod</span></div>
<div class="line">$ sudo apt-get install pigpio</div>
<div class="line">$ sudo systemctl enable pigpiod.service</div>
<div class="line">$ sudo systemctl start pigpiod.service</div>
<div class="line"> </div>
<div class="line"><span class="comment"># On Raspbian Stretch pigpiod per default only binds to IPv6.</span></div>
<div class="line"><span class="comment"># If you prefer IPv4 instead, execute the following steps:</span></div>
<div class="line"><span class="comment"># Open /etc/modprobe.d/ipv6.conf and add the following line at the bottom:</span></div>
<div class="line">    blacklist ipv6</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Edit the pigpiod service file /lib/systemd/system/pigpiod.service (remove the &#39;-l&#39; option for ExecStart):</span></div>
<div class="line">    [Unit]</div>
<div class="line">    Description=Daemon required to control GPIO pins via pigpio</div>
<div class="line">    [Service]</div>
<div class="line">    <span class="comment">#ExecStart=/usr/bin/pigpiod -l</span></div>
<div class="line">    ExecStart=/usr/bin/pigpiod</div>
<div class="line">    ExecStop=/bin/systemctl kill pigpiod</div>
<div class="line">    Type=forking</div>
<div class="line">    [Install]</div>
<div class="line">    WantedBy=multi-user.target</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Next reboot your Raspberry.</span></div>
<div class="line">$ sudo systemctl reboot</div>
<div class="line"> </div>
<div class="line"><span class="comment"># After reboot check if pigpiod is now listening on port 8888 and is bound to IPv4:</span></div>
<div class="line">$ netstat -ln | grep 8888</div>
<div class="line">tcp        0      0 0.0.0.0:8888            0.0.0.0:*               LISTEN</div>
</div><!-- fragment --> <h2><a class="anchor" id="PIGPIoUsage"></a>
Basic Usage Example</h2>
<p >Below is a simple Python code snippet which uses the pigpio library to connect to a Raspberry PI which is running a pigpiod instance. Connected to it is an I2C slave of which a register is written and read back.</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> pigpio, logging</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>test_RegWriteRead(self):</div>
<div class="line">    logging.getLogger().debug(<span class="stringliteral">&quot;Starting register write/read test.&quot;</span>)</div>
<div class="line">    reg_addr = 0x40</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># connect to Raspberry Pi</span></div>
<div class="line">    pi = pigpio.pi(<span class="stringliteral">&quot;10.10.171.82&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># open I2C bus 1, set I2C device slave address to 0x52</span></div>
<div class="line">    dev = pi.i2c_open(1, 0x52)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># clear and verify the register</span></div>
<div class="line">    pi.i2c_write_byte_data(dev, reg_addr, 0x0)</div>
<div class="line">    val = pi.i2c_read_byte_data(dev, reg_addr)</div>
<div class="line">    assert(0x0 == val), (<span class="stringliteral">&quot;Clearing register 0x%x failed.&quot;</span> % reg_addr)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># write and verify test value</span></div>
<div class="line">    pi.i2c_write_byte_data(dev, reg_addr, 0xa5)</div>
<div class="line">    val = pi.i2c_read_byte_data(dev, reg_addr)</div>
<div class="line">    assert(0xa5 == val), (<span class="stringliteral">&quot;Writing test value to register 0x%x failed.&quot;</span> % reg_addr)</div>
</div><!-- fragment --><h2><a class="anchor" id="PigpiDoc"></a>
PIGPIO Python Documentation</h2>
<p >The full documentation for the Python pigpio library is available <a href="http://abyz.me.uk/rpi/pigpio/python.html">online</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
